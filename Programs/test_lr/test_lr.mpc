Params.set_params(int_precision=32, f=16, k=32)
NUM_PARTIES = 3

SGD_ITERS = 5
data_sizes = [(i, 10) for i in range(NUM_PARTIES)]
dim = 10
BATCH_SIZE = 5

sfix.set_precision(32)

X = s_fix_mat.read_input_variable_rows(dim, data_sizes)
y = s_fix_mat.read_input_variable_rows(1, data_sizes)

w = s_fix_mat(dim, 1)
alpha_B = c_fix(100)

for i in range(SGD_ITERS):
    batch_low = i * BATCH_SIZE
    batch_high = (i + 1) * BATCH_SIZE
    
    XB = s_fix_mat(BATCH_SIZE, dim)
    yB = s_fix_mat(BATCH_SIZE, 1)

    for j in range(BATCH_SIZE):
        for d in range(dim):
            XB[j][d] = X[batch_low + j][d]
        yB[j][0] = y[batch_low + j][0]

    w_ret = matmul(XB, w)
    w_sigmoid = sigmoid(w_ret)
    w_sub = matsub(w_sigmoid, yB)
    XB_T = transpose(XB)
    w_1 = matmul(XB_T, w_sub)
    w_2 = mat_const_mul(alpha_B, w_1)
    w_res = matsub(w, w_2)
    mat_assign(w, w_res)

for i in range(dim):
    w[i][0].reveal()
